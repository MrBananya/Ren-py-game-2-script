# Карта мира 
default cell_for_movement = [
    #1
    {"id": 1, "name": "desert", "image": "globalmap/desert.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #2
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #3
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #4
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #5
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #6
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "wheat_field", "image": "globalmap/wheat_field.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "wheat_field", "image": "globalmap/wheat_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #7
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mine", "image": "globalmap/mine.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 3, "name": "city", "image": "globalmap/city.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },
    {"id": 1, "name": "road", "image": "globalmap/road_1.png" },

    #8
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "wheat_field", "image": "globalmap/wheat_field.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "wheat_field", "image": "globalmap/wheat_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #9
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #10
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #11
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "mountain", "image": "globalmap/mountain.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #12
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },
    {"id": 1, "name": "forest", "image": "globalmap/forest.png" },

    #13
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 3, "name": "road", "image": "globalmap/road_2.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },
    {"id": 1, "name": "open_field", "image": "globalmap/open_field.png" },

    #14
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },
     {"id": 1, "name": "beach_1", "image": "globalmap/beach_1.png" },


]
# Экран леса
default forestNumber = 1

# координаты для расположения предмета
default flower_pos_x = 0
default flower_pos_y = 0
default flower_collect_bool = False
default forest_screen_back = 0

default enemy_attack = False
# Просчет координат клеток(чтобы ручками все это не писать)--------------------------------------------------------------------
label cell_update:
    $ tmp_x = 0
    $ tmp_y = 0
    python:
        for cell in cell_for_movement:
            cell.update({"x": tmp_x, "y": tmp_y})  # Добавление значений "x" и "y"
            tmp_x += 1
            if tmp_x >= 17:
                tmp_x -= 17  # Сброс "x" до 0
                tmp_y += 1   # Увеличение "y"
    return

# Как далеко игрок может ходить по клеткам на глобальной карте-------------------------------------------------------------------
label show_cell_pos:
    show screen globalmap_screen
    if Player_weight[0] >= Player_weight[1]:
        "Вы перегружены и не можете путешествовать"
        hide screen globalmap_screen
        call screen globalmap_screen
    if Player_stamina[0] <= 0:
        "Вы устали и не можете больше путешествовать"
        hide screen globalmap_screen
        call screen globalmap_screen

    if  abs(Cell_x_pos - Player_pos[0]) <= 1 and abs(Cell_y_pos - Player_pos[1]) <= 1:
        $ Player_pos[0] = Cell_x_pos
        $ Player_pos[1] = Cell_y_pos
        python:
            for cell in cell_for_movement:
                if Player_pos[0] == cell["x"] and Player_pos[1] == cell["y"]:
                    Player_pos_cell_name = cell["name"]
        $ Minutes += 10
        $ Player_satiety_food[0] -= 1
        $ Player_satiety_water[0] -= 1
        $ Player_stamina[0] -= 1
        call time_counter

    hide screen globalmap_screen
    call screen globalmap_screen

# Для перехода между локациями (куда возвращатсья)-----------------------------------------------------------------------------
label screen_in_city_jump_from_back:
    scene bg_2
    if current_screen_back == "move_screen_guild":
        call screen move_screen_guild
    if current_screen_back == "move_screen_city":
        call screen move_screen_city
    if current_screen_back == "globalmap_screen":
        call screen globalmap_screen
    if current_screen_back == "move_screen_forest":
        if forest_screen_back == 1:
            $ forestNumber = 1
        if forest_screen_back == 2:
            $ forestNumber = 2
        if forest_screen_back == 3:
            $ forestNumber = 3
        if forest_screen_back == 4:
            $ forestNumber = 4
        if forest_screen_back == 5:
            $ forestNumber = 5
        call screen forest_screen
    if current_screen_back == "shop":
        $ current_screen = "main_trade_screen"
        call screen shop

# Для перехода между локациями (куда идти)---------------------------------------------------------------------------
label screen_in_city_jump:
    scene bg_2
    call tasks_update
    if current_screen == "move_screen_guild":
        call time_counter
        call screen move_screen_guild

    if current_screen == "move_screen_city":
        call time_counter
        call screen move_screen_city

    if current_screen == "globalmap_screen":
        call time_counter
        call screen globalmap_screen

    if current_screen == "shop":
        if Hours > 22 or Hours < 6:
            python:
                renpy.notify("Магазин закрыт")
            $ current_screen = "move_screen_city"
            jump screen_in_city_jump
        $ current_screen = "main_trade_screen"
        call time_counter
        call screen shop

    if current_screen == "move_screen_forest":
        $ enemy_attack = False
        call time_counter
        call screen forest_screen

    if current_screen == "backpack_screen":
        jump update_inventory_weight2

# Додавляем вещи из леса в инвентарь----------------------------------------------------------------------------
label add_forest_item:
    # Добавление предмета
    $ chance_modifier = player_passive_skills[0]["current_level"] * 0.05
    $ tmp_rnd = renpy.random.randint(0, 1)
    if len(items) == 0:
        $new_item = global_items_in_the_game[2]# {"id": 3,"name": "Цветок лечения","quest_item": False,"quantity": 1,"description": "Используется для создания исцеляющих снадобий", "cbeqiped": False, "slot": "none",  "dmg": 0, "arm":0, "image": "icon/flower1.png","weight": 0.1, "sell_price": 1, "buy_price": 2  }
        $items.append(new_item)
        $ player_passive_skills[0]["current_level_point"] += 0.5
        $ Player_stats[1] += 0.1
        $ renpy.notify("Подобран предмет:" +str(new_item["name"]) +" Количество: " +str(new_item["quantity"])) 
        call update_skills_label
        jump screen_in_city_jump
    else:
        $ found = False
        python:
            for item in items:
                 if item["id"] == 3:
                    if renpy.random.random() < chance_modifier:  # Проверяем шанс
                        new_quantity = renpy.random.randint(1, 2)  # Генерируем количество предметов
                        renpy.notify("Подобран предмет: " +str(item["name"]) +" Количество: " +str(new_quantity))
                        item["quantity"] += new_quantity
                    else:
                        renpy.notify(f"Подобран предмет: {item['name']} (Количество: 1)")
                        item["quantity"] += 1
                    found = True
                    player_passive_skills[0]["current_level_point"] += 0.5
                    Player_stats[1] += 0.1 
                    renpy.call(label='update_skills_label') 
                    renpy.jump(label='screen_in_city_jump')
        if not found:
            $new_item =  global_items_in_the_game[2]#{"id": 3,"name": "Цветок лечения","quest_item": False,"quantity": 1,"description": "Используется для создания исцеляющих снадобий", "cbeqiped": False, "slot": "none",  "dmg": 0, "arm":0, "image": "icon/flower1.png","weight": 0.1, "sell_price": 1, "buy_price": 2  }
            $items.append(new_item)
            $ player_passive_skills[0]["current_level_point"] += 0.5
            $ Player_stats[1] += 0.1
            $ renpy.notify("Подобран предмет:" +str(new_item["name"]) +" Количество: " +str(new_item["quantity"])) 
            call update_skills_label
            jump screen_in_city_jump
        jump screen_in_city_jump


# Локация лес. Рандомные локации----------------------------------------------------------------------------
label forest_jump_another_location:
    show screen forest_screen
    $ tmp_enemy_attack = renpy.random.randint(0,5)
    if  tmp_enemy_attack == 5:
        $ enemy_attack = True
        "Вы наткнулись на противника. Приготовьтесь к бою"
        hide screen forest_screen
        jump before_battle
    $ flower_collect_bool = False
    $ forestNumber = renpy.random.randint(1,5)
    if forestNumber == 1:
        $ flower_pos_x = renpy.random.randint(72, 1785)
        $ flower_pos_y = renpy.random.randint(715, 790)
    if forestNumber == 2:
        $ flower_pos_x = renpy.random.randint(81, 673)
        $ flower_pos_y = renpy.random.randint(513, 729)
    if forestNumber == 3:
        $ flower_pos_x = renpy.random.randint(130, 1668)
        $ flower_pos_y = renpy.random.randint(432, 735)
    if forestNumber == 4:
        $ flower_pos_x = renpy.random.randint(115, 1744)
        $ flower_pos_y = renpy.random.randint(351, 670)
    if forestNumber == 5:
        $ flower_pos_x = renpy.random.randint(153, 1625)
        $ flower_pos_y = renpy.random.randint(683, 994)
    jump screen_in_city_jump

# Локация Лес--------------------------------------------------------------------------------------------------
# показ цветочков
screen forest_screen:
    imagemap:
        #text "[forestNumber]" at topright
        if forestNumber == 1:
            idle 'forest/1.png'
            #(72, 644, 1785, 187)
            if flower_collect_bool == False:
                imagebutton:
                    idle im.Scale('icon/flower1.png', 75, 75) at Position(xpos = flower_pos_x, ypos = flower_pos_y)
                    hover im.Alpha(im.Scale('icon/flower1.png', 75, 75), 0.5)
                    action SetVariable("flower_collect_bool", True), Jump('add_forest_item') 
            #add im.Scale("icon/flower1.png", 75, 75) at Position(xpos = flower_pos_x, xanchor = 0, ypos = flower_pos_y, yanchor = 0)
        if forestNumber == 2:
            idle 'forest/2.png'
            #(81, 513, 673, 216) (964, 547, 844, 199)
            if flower_collect_bool == False:
                imagebutton:
                    idle im.Scale('icon/flower1.png', 75, 75) at Position(xpos = flower_pos_x, ypos = flower_pos_y)
                    hover im.Alpha(im.Scale('icon/flower1.png', 75, 75), 0.5)
                    action SetVariable("flower_collect_bool", True), Jump('add_forest_item') 
        if forestNumber == 3:
            idle 'forest/3.png'
            #(130, 432, 1668, 303)
            if flower_collect_bool == False:
                imagebutton:
                    idle im.Scale('icon/flower1.png', 75, 75) at Position(xpos = flower_pos_x, ypos = flower_pos_y)
                    hover im.Alpha(im.Scale('icon/flower1.png', 75, 75), 0.5)
                    action SetVariable("flower_collect_bool", True), Jump('add_forest_item') 
        if forestNumber == 4:
            idle 'forest/4.png'
            #(115, 351, 1744, 319)
            if flower_collect_bool == False:
                imagebutton:
                    idle im.Scale('icon/flower1.png', 75, 75) at Position(xpos = flower_pos_x, ypos = flower_pos_y)
                    hover im.Alpha(im.Scale('icon/flower1.png', 75, 75), 0.5)
                    action SetVariable("flower_collect_bool", True), Jump('add_forest_item') 
        if forestNumber == 5:
            idle 'forest/5.png'
            #(153, 683, 1625, 311)
            if flower_collect_bool == False:
                imagebutton:
                    idle im.Scale('icon/flower1.png', 75, 75) at Position(xpos = flower_pos_x, ypos = flower_pos_y)
                    hover im.Alpha(im.Scale('icon/flower1.png', 75, 75), 0.5)
                    action SetVariable("flower_collect_bool", True), Jump('add_forest_item') 
        if enemy_attack == False:
            transform:
                rotate 270
                imagebutton:
                    idle im.Scale('icon/plain-arrow.png', 150, 100) at right
                    hover im.Alpha(im.Scale('icon/plain-arrow.png', 150, 100), 0.5)
                    action SetVariable("current_screen", "move_screen_forest"), Jump('forest_jump_another_location') 
            transform:
                rotate 90
                imagebutton:
                    idle im.Scale('icon/plain-arrow.png', 150, 100) at left
                    hover im.Alpha(im.Scale('icon/plain-arrow.png', 150, 100), 0.5)
                    action SetVariable("current_screen", "move_screen_forest"), Jump('forest_jump_another_location') 

        hbox spacing 5:
            imagebutton:
                idle im.Scale('icon/map.png', 75, 75) 
                hover im.Alpha(im.Scale('icon/map.png', 75, 75), 0.5)
                action SetVariable("current_screen", "globalmap_screen"), Jump('screen_in_city_jump')
            imagebutton:
                idle im.Scale('icon/backpack.webp', 85, 85) 
                hover im.Alpha(im.Scale('icon/backpack.webp', 85, 85), 0.5)
                action SetVariable("current_screen", "backpack_screen"), SetVariable("current_screen_back", "move_screen_forest"), SetVariable("forest_screen_back", "forestNumber"), Jump('screen_in_city_jump')


# церковь----------------------------------------------------------------------------------------------
screen move_screen_church:
    imagemap:
        idle 'church'
    vbox spacing 5:
        imagebutton:
            idle im.Scale('icon/go_back.png', 85, 85) 
            hover im.Alpha(im.Scale('icon/go_back.png', 85, 85), 0.5)
            action SetVariable("current_screen", "globalmap_screen"), Jump('screen_in_city_jump')  
        imagebutton:
            idle im.Scale('icon/backpack.webp', 85, 85) 
            hover im.Alpha(im.Scale('icon/backpack.webp', 85, 85), 0.5)
            action SetVariable("current_screen", "backpack_screen"), SetVariable("current_screen_back", "move_screen_church"), Jump('screen_in_city_jump')  

# Город----------------------------------------------------------------------------------------------
screen move_screen_city:
    $ filtered_tasks = list(filter(lambda task: task['id'] == 4, tasks_in_game))
    imagemap:
        if Hours >= 6 and Hours < 16: 
            if filtered_tasks[0]["quest_progress"] == 1:
                idle 'city_day_cat'
                hover "city_day_cat_hover"
                hotspot (919, 101, 100, 103) action Jump('cat_task') #котик
            else:
                idle 'city_day'
                hover "city_day_hover"
        if Hours >= 16 and Hours < 20:
            idle 'city_evening'
            hover "city_day_hover"
        if (Hours >= 20 and Hours < 25) or Hours < 6:
            idle 'city_night'
            hover "city_day_hover"
            
        add im.Alpha(im.Scale('gui/frame.png', 400, 250), 0.5) xpos 1450 ypos 0
        hotspot (1503, 424, 161, 451) action SetVariable("current_screen", "move_screen_guild"), Jump('screen_in_city_jump')
        hotspot (434, 451, 132, 222) action SetVariable("current_screen", "shop"), Jump('screen_in_city_jump') # в магазин
        text "{size=32}{color=#ffffff}[Days] день {/color}{/size}" xpos 1610 ypos 15
        text "{size=32}{color=#ffffff}[Hours]:[MinutesStr]{/color}{/size}" xpos 1500 ypos 15

    hbox spacing 5:
        imagebutton:
            idle im.Scale('icon/map.png', 75, 75) 
            hover im.Alpha(im.Scale('icon/map.png', 75, 75), 0.5)
            action SetVariable("current_screen", "globalmap_screen"), Jump('screen_in_city_jump')  
        imagebutton:
            idle im.Scale('icon/backpack.webp', 85, 85) 
            hover im.Alpha(im.Scale('icon/backpack.webp', 85, 85), 0.5)
            action SetVariable("current_screen", "backpack_screen"), SetVariable("current_screen_back", "move_screen_city"), Jump('screen_in_city_jump')
        imagebutton:
            idle im.Scale('icon/time_sand.png', 85, 85) 
            hover im.Alpha(im.Scale('icon/time_sand.png', 85, 85), 0.5)
            action SetVariable("current_screen", "move_screen_city"), Jump('player_rest_label')

    use coin_screen
    
    use healthbar_screen (xpos=1480, ypos=100, xsize=220, ysize=25, show_text=False)
    use staminabar_screen (xpos=1480, ypos=130, xsize=220, ysize=25, show_text=False)
    use manabar_screen (xpos=1480, ypos=160, xsize=220, ysize=25, show_text=False)
    use foodbar_screen (xpos=1480, ypos=200, xsize=100, ysize=25, show_text=False)
    use waterbar_screen (xpos=1600, ypos=200, xsize=100, ysize=25, show_text=False)
        
# Гильдия----------------------------------------------------------------------------------------------
screen move_screen_guild:
    imagemap:
        idle 'guild_1'
        hover 'guild_1_hover' 
        hotspot (293, 374, 364, 117) action Jump('task_board_label_1') # ВЗять задание
        hotspot (938, 409, 370, 261) action Jump("talk_task_guild") # Поговорить с управляющим
        add im.Alpha(im.Scale('gui/frame.png', 400, 250), 0.5) xpos 1450 ypos 0
        text "{size=32}{color=#ffffff}[Days] день {/color}{/size}" xpos 1610 ypos 15
        text "{size=32}{color=#ffffff}[Hours]:[MinutesStr]{/color}{/size}" xpos 1500 ypos 15
    hbox spacing 5:
        imagebutton:
            idle im.Scale('icon/go_back.png', 75, 75) 
            hover im.Alpha(im.Scale('icon/go_back.png', 75, 75), 0.5)
            action SetVariable("current_screen", "move_screen_city"), Jump('screen_in_city_jump')  
        imagebutton:
            idle im.Scale('icon/backpack.webp', 85, 85) 
            hover im.Alpha(im.Scale('icon/backpack.webp', 85, 85), 0.5)
            action SetVariable("current_screen", "backpack_screen"), SetVariable("current_screen_back", "move_screen_guild"),  Jump('screen_in_city_jump')
    
    use coin_screen
    
    use healthbar_screen (xpos=1480, ypos=100, xsize=220, ysize=25, show_text=False)
    use staminabar_screen (xpos=1480, ypos=130, xsize=220, ysize=25, show_text=False)
    use manabar_screen (xpos=1480, ypos=160, xsize=220, ysize=25, show_text=False)
    use foodbar_screen (xpos=1480, ypos=200, xsize=100, ysize=25, show_text=False)
    use waterbar_screen (xpos=1600, ypos=200, xsize=100, ysize=25, show_text=False)




# Глобальная карта----------------------------------------------------------------------------------------------
screen globalmap_screen:
    imagemap:
        idle im.Alpha(im.Scale('map_bg.webp', 1920, 1080), 0.5)
        text "{size=32}{color=#ffffff}[Days] день {/color}{/size}" xpos 1610 ypos 15
        text "{size=32}{color=#ffffff}[Hours]:[MinutesStr]{/color}{/size}" xpos 1610 ypos 45

    hbox spacing 5:
        imagebutton:
                idle im.Scale('icon/backpack.webp', 85, 85) 
                hover im.Alpha(im.Scale('icon/backpack.webp', 85, 85), 0.5)
                action SetVariable("current_screen", "backpack_screen"), SetVariable("current_screen_back", "globalmap_screen"), Jump('screen_in_city_jump')
        imagebutton:
                idle im.Scale('icon/time_sand.png', 85, 85) 
                hover im.Alpha(im.Scale('icon/time_sand.png', 85, 85), 0.5)
                action SetVariable("current_screen", "globalmap_screen"), Jump('player_rest_label')

    vbox xalign 0.5 yalign 0.5 spacing 0:
        #add im.Scale('globalmap/position.png', 75, 75 ) xpos Cell_x_pos *75  ypos Cell_y_pos *75
        for i in range(0, len(cell_for_movement), 17):
            hbox:
                for cell in cell_for_movement[i:i+17]:
                    imagebutton:
                        idle im.Scale(cell["image"], 75, 75)
                        action SetVariable("Cell_x_pos", cell["x"]), SetVariable("Cell_y_pos", cell["y"]), Jump("show_cell_pos")  #hovered tt.action(str(Cell_x_pos) + ", " + str(Cell_y_pos))
                        hover im.Alpha(im.Scale('globalmap/hover.png', 75, 75), 0.8)

    vbox xalign 0.175 yalign 0 spacing 0:
        add im.Scale('globalmap/position.png', 75, 75 ) xpos Player_pos[0] *75  ypos Player_pos[1] *75
    #Показ текущей клетки для отладки
    #text "x = %i ,y = %i, %s " % (Player_pos[0], Player_pos[1], Player_pos_cell_name)

    if Player_pos[0] == 8 and Player_pos[1] == 6:
        textbutton "{color=#FFFFFF}{size=32} Войти  {/size}{/color}" xpos 1600 ypos 800:
            action SetVariable("current_screen", "move_screen_city"), Jump("screen_in_city_jump")
   
    if Player_pos_cell_name == "forest":
        textbutton "{color=#FFFFFF}{size=32} Войти  {/size}{/color}" xpos 1600 ypos 800:
            action SetVariable("current_screen", "move_screen_forest"), Jump("forest_jump_another_location")







